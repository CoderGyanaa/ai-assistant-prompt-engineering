<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Assistant - Prompt Engineering Project</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ AI Assistant</h1>
            <p class="subtitle">Your Intelligent Personal Assistant</p>
        </header>

        <div class="function-selector">
            <h2>Select a Function:</h2>
            <div class="button-group">
                <button class="function-btn active" data-function="question">
                    üìö Answer Questions
                </button>
                <button class="function-btn" data-function="summarize">
                    üìù Summarize Text
                </button>
                <button class="function-btn" data-function="creative">
                    ‚ú® Generate Creative Content
                </button>
            </div>
        </div>

        <div class="input-section">
            <div class="prompt-examples" id="promptExamples">
                <!-- Examples will be populated by JavaScript -->
            </div>

            <textarea 
                id="userInput" 
                placeholder="Enter your query here..."
                rows="5"
            ></textarea>

            <button id="submitBtn" class="submit-btn">
                Generate Response
            </button>
        </div>

        <div id="responseSection" class="response-section" style="display: none;">
            <h3>Response:</h3>
            <div id="responseText" class="response-text"></div>

            <div class="feedback-section">
                <p class="feedback-question">Was this response helpful?</p>
                <div class="feedback-buttons">
                    <button class="feedback-btn yes-btn" data-helpful="yes">
                        üëç Yes
                    </button>
                    <button class="feedback-btn no-btn" data-helpful="no">
                        üëé No
                    </button>
                </div>
                <p id="feedbackMessage" class="feedback-message"></p>
            </div>
        </div>

        <div class="info-section">
            <h3>About This AI Assistant</h3>
            <div class="info-grid">
                <div class="info-card">
                    <h4>üìö Answer Questions</h4>
                    <p>Get factual answers to your questions with varying levels of detail.</p>
                    <ul>
                        <li>Direct & concise answers</li>
                        <li>Detailed explanations</li>
                        <li>Simple language options</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h4>üìù Summarize Text</h4>
                    <p>Transform long texts into concise summaries.</p>
                    <ul>
                        <li>Brief 2-3 sentence summaries</li>
                        <li>Detailed main points</li>
                        <li>Bullet-point format</li>
                    </ul>
                </div>
                <div class="info-card">
                    <h4>‚ú® Generate Creative Content</h4>
                    <p>Create original stories, poems, and ideas.</p>
                    <ul>
                        <li>Short stories</li>
                        <li>Poetry</li>
                        <li>Creative concepts</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const examples = {
            question: [
                "What is the capital of France?",
                "Who invented the telephone?",
                "What is photosynthesis?"
            ],
            summarize: [
                "Paste an article or long text here to summarize",
                "Enter any document text for a quick overview",
                "Input text to extract main points"
            ],
            creative: [
                "Write a short story about a dragon and a princess",
                "Create a poem about autumn",
                "Generate an idea for a science fiction novel"
            ]
        };

        let currentFunction = 'question';
        let lastResponse = '';
        let lastQuery = '';

        // Function button handling
        document.querySelectorAll('.function-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.function-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFunction = this.dataset.function;
                updateExamples();
                document.getElementById('responseSection').style.display = 'none';
                document.getElementById('userInput').value = '';
            });
        });

        function updateExamples() {
            const examplesDiv = document.getElementById('promptExamples');
            examplesDiv.innerHTML = '<h4>Example Prompts:</h4><ul>' +
                examples[currentFunction].map(ex => `<li>${ex}</li>`).join('') +
                '</ul>';
        }

        updateExamples();

        // Submit button handling
        document.getElementById('submitBtn').addEventListener('click', async function() {
            const input = document.getElementById('userInput').value.trim();
            
            if (!input) {
                alert('Please enter some input!');
                return;
            }

            this.disabled = true;
            this.textContent = 'Processing...';

            try {
                const response = await fetch('/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        function: currentFunction,
                        input: input
                    })
                });

                const data = await response.json();

                if (data.error) {
                    alert(data.error);
                } else {
                    lastQuery = input;
                    lastResponse = data.response;
                    document.getElementById('responseText').textContent = data.response;
                    document.getElementById('responseSection').style.display = 'block';
                    document.getElementById('feedbackMessage').textContent = '';
                    document.getElementById('responseSection').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                alert('An error occurred. Please try again.');
                console.error(error);
            } finally {
                this.disabled = false;
                this.textContent = 'Generate Response';
            }
        });

        // Feedback handling
        document.querySelectorAll('.feedback-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                const helpful = this.dataset.helpful;

                try {
                    const response = await fetch('/feedback', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            function: currentFunction,
                            query: lastQuery,
                            response: lastResponse,
                            helpful: helpful
                        })
                    });

                    const data = await response.json();
                    document.getElementById('feedbackMessage').textContent = data.message;
                    
                    // Disable feedback buttons after submission
                    document.querySelectorAll('.feedback-btn').forEach(b => b.disabled = true);
                    
                    setTimeout(() => {
                        document.querySelectorAll('.feedback-btn').forEach(b => b.disabled = false);
                    }, 2000);
                } catch (error) {
                    console.error('Error submitting feedback:', error);
                }
            });
        });

        // Enter key support
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                document.getElementById('submitBtn').click();
            }
        });
    </script>
</body>
</html>